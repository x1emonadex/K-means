// ============================================================================
// –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó–ê–¢–û–† –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–ò K-MEANS
// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Windows —Å –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
// –†–µ–∞–ª–∏–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º K-means++ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
// ============================================================================

// === –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ë–ò–ë–õ–ò–û–¢–ï–ö ===
#include <windows.h>        // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Windows API
#include <commctrl.h>       // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (ListView, TabControl, ProgressBar)
#include <commdlg.h>        // –î–∏–∞–ª–æ–≥–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
#include <vector>           // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Å–∏–≤—ã
#include <string>           // –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
#include <fstream>          // –§–∞–π–ª–æ–≤—ã–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥
#include <sstream>          // –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
#include <cmath>            // –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (sqrt, pow)
#include <random>           // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –¥–ª—è K-means++
#include <algorithm>        // –ê–ª–≥–æ—Ä–∏—Ç–º—ã (min, max, remove_if)
#include <limits>           // –ß–∏—Å–ª–æ–≤—ã–µ –ª–∏–º–∏—Ç—ã (max double value)
#include <iomanip>          // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ (setprecision)
#include <chrono>           // –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
#pragma comment(lib, "comctl32.lib")

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–∞–∫—Ä–æ—Å–æ–≤ min/max –∏–∑ windows.h –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å std::min/max
#ifdef max
#undef max
#endif
#ifdef min
#undef min
#endif

// === –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†–´ –≠–õ–ï–ú–ï–ù–¢–û–í –ò–ù–¢–ï–†–§–ï–ô–°–ê ===
#define ID_LOAD_BUTTON 1001        // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
#define ID_CALC_BUTTON 1002        // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
#define ID_K_INPUT 1003            // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
#define ID_THRESHOLD_INPUT 1004    // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
#define ID_MAX_ITER_INPUT 1005     // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π
#define ID_EXPORT_BUTTON 1007      // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
#define ID_CLEAR_BUTTON 1008       // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
#define ID_RESULTS_LIST 1009       // –¢–∞–±–ª–∏—Ü–∞ –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
#define ID_CLUSTERS_LIST 1010      // –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
#define ID_POINTS_LIST 1011        // –¢–∞–±–ª–∏—Ü–∞ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
#define ID_STATS_LIST 1012         // –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

// === –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
HINSTANCE hInst;                                    // –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
WCHAR szTitle[] = L"–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ K-means - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è";  // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞
WCHAR szWindowClass[] = L"KmeansAnalyzerClass";     // –ò–º—è –∫–ª–∞—Å—Å–∞ –æ–∫–Ω–∞
OPENFILENAME ofn;                                   // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ —Ñ–∞–π–ª–æ–≤
wchar_t szFile[MAX_PATH] = L"";                     // –ü—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–º—É —Ñ–∞–π–ª—É
wchar_t szSaveFile[MAX_PATH] = L"";                 // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

// === –®–†–ò–§–¢–´ –î–õ–Ø –†–ê–ó–õ–ò–ß–ù–´–• –≠–õ–ï–ú–ï–ù–¢–û–í –ò–ù–¢–ï–†–§–ï–ô–°–ê ===
HFONT hFontTitle,      // –ö—Ä—É–ø–Ω—ã–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
      hFontButton,     // –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫
      hFontText,       // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞
      hFontBold,       // –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
      hFontRange;      // –ü–æ–ª—É–∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π

// === –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–• ===

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ –≤ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
struct Point {
    std::vector<double> coords;    // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–∫–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–∞—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å)
    int clusterLabel = -1;         // –ù–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–æ—á–∫–∞ (-1 = –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω)
    int originalIndex = 0;         // –ò—Å—Ö–æ–¥–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ç–æ—á–∫–∏ –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
};

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–µ
struct ClusterInfo {
    std::vector<double> centroid;  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
    int pointCount = 0;            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
    double avgDistance = 0.0;      // –°—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–µ–∫ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
    double minDistance = std::numeric_limits<double>::max();  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
    double maxDistance = 0.0;      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
    double variance = 0.0;         // –î–∏—Å–ø–µ—Ä—Å–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
    double compactness = 0.0;      // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ (0-1)
};

// === –î–ê–ù–ù–´–ï –ê–õ–ì–û–†–ò–¢–ú–ê ===
std::vector<Point> points;              // –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
std::vector<ClusterInfo> clusters;      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
int k = 3;                              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
int maxIterations = 100;                // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
double convergenceThreshold = 0.01;     // –ü–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
int currentIteration = 0;               // –¢–µ–∫—É—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
bool isConverged = false;               // –§–ª–∞–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
double totalSSE = 0.0;                  // –û–±—â–∞—è —Å—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫ (Sum of Squared Errors)
std::mt19937 rng(std::random_device{}()); // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª –¥–ª—è K-means++
std::chrono::steady_clock::time_point startTime; // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞

// === –î–ï–°–ö–†–ò–ü–¢–û–†–´ –≠–õ–ï–ú–ï–ù–¢–û–í –ò–ù–¢–ï–†–§–ï–ô–°–ê ===
// –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
HWND hLoadBtn,      // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
     hCalcBtn,      // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
     hExportBtn,    // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
     hClearBtn;     // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö

// –ü–æ–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
HWND hKInput,           // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
     hThresholdInput,   // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
     hMaxIterInput;     // –ü–æ–ª–µ –≤–≤–æ–¥–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π

// –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
HWND hResultsList,   // –¢–∞–±–ª–∏—Ü–∞ –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
     hClustersList,  // –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
     hPointsList,    // –¢–∞–±–ª–∏—Ü–∞ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
     hStatsList;     // –¢–∞–±–ª–∏—Ü–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

// –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç—É—Å–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
HWND hStatusText,    // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
     hProgressBar;   // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

// –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
HWND hTabControl;    // –ö–æ–Ω—Ç—Ä–æ–ª –≤–∫–ª–∞–¥–æ–∫ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

// –ü–æ–¥–ø–∏—Å–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π
HWND hKRangeLabel,      // –ü–æ–¥–ø–∏—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
     hThresholdRange,   // –ü–æ–¥–ø–∏—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
     hIterRange;        // –ü–æ–¥–ø–∏—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π

// === –û–ë–™–Ø–í–õ–ï–ù–ò–Ø –§–£–ù–ö–¶–ò–ô ===

// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Windows
LRESULT CALLBACK WndProc(HWND, UINT, WPARAM, LPARAM);  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–∫–Ω–∞

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
void InitializeResources();    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à—Ä–∏—Ñ—Ç–æ–≤ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤
void CleanupResources();       // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

// –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
void CreateInterface(HWND hWnd);                           // –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
void ResizeInterface(HWND hWnd, int width, int height);    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ –æ–∫–Ω–∞
HWND CreateListView(HWND parent, int x, int y, int w, int h, int id);  // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ListView
void AddListColumn(HWND hList, LPCWSTR text, int width, int index);    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É
void AddListItem(HWND hList, int item, int subitem, LPCWSTR text);     // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü—É
void ClearList(HWND hList);                                            // –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
void CreateTabControl(HWND hWnd);                                      // –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤–∫–ª–∞–¥–æ–∫
void ShowTabContent(int tabIndex);                                     // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
void UpdateKRangeLabel();                                              // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ K

// –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
void ShowWelcomeScreen();       // –ü–æ–∫–∞–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
void ShowDataLoadedInfo();      // –ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
void ShowClusteringResults();   // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
void UpdateStatus(const std::wstring& message);  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–∞–Ω–Ω—ã–º–∏
void PopulateResultsTable();   // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
void PopulateClustersTable();  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
void PopulatePointsTable();    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
void PopulateStatsTable();     // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ K-means
void LoadDataFile();                    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV —Ñ–∞–π–ª–∞
void RunClusteringAnalysis();           // –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
void InitializeCentroidsKMeansPlusPlus(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –º–µ—Ç–æ–¥–æ–º K-means++
double CalculateEuclideanDistance(const std::vector<double>& a, const std::vector<double>& b); // –†–∞—Å—á–µ—Ç –µ–≤–∫–ª–∏–¥–æ–≤–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
void AssignPointsToClusters();          // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫ –±–ª–∏–∂–∞–π—à–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º
void UpdateClusterCentroids();          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤
void CalculateDetailedStatistics();     // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
bool ExportDetailedResults();           // –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ñ–∞–π–ª
void ClearAllData();                    // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è

// ============================================================================
// –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ============================================================================
int APIENTRY wWinMain(HINSTANCE hInstance, HINSTANCE, LPWSTR, int nCmdShow)
{
    hInst = hInstance;  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Windows
    INITCOMMONCONTROLSEX icex;
    icex.dwSize = sizeof(INITCOMMONCONTROLSEX);
    // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É ListView, ProgressBar –∏ TabControl
    icex.dwICC = ICC_LISTVIEW_CLASSES | ICC_PROGRESS_CLASS | ICC_TAB_CLASSES;
    InitCommonControlsEx(&icex);

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ –æ–∫–Ω–∞
    WNDCLASSEXW wcex = { sizeof(WNDCLASSEX) };
    wcex.style = CS_HREDRAW | CS_VREDRAW;        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
    wcex.lpfnWndProc = WndProc;                  // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    wcex.hInstance = hInst;                      // –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
    wcex.hIcon = LoadIcon(nullptr, IDI_APPLICATION);     // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞
    wcex.hCursor = LoadCursor(nullptr, IDC_ARROW);       // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫—É—Ä—Å–æ—Ä
    wcex.hbrBackground = (HBRUSH)(COLOR_WINDOW + 1);     // –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –æ–∫–Ω–∞
    wcex.lpszClassName = szWindowClass;          // –ò–º—è –∫–ª–∞—Å—Å–∞ –æ–∫–Ω–∞

    RegisterClassExW(&wcex);  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–ª–∞—Å—Å –≤ —Å–∏—Å—Ç–µ–º–µ

    // –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    HWND hWnd = CreateWindowW(szWindowClass, szTitle, WS_OVERLAPPEDWINDOW,
        CW_USEDEFAULT, 0,    // –ü–æ–∑–∏—Ü–∏—è –æ–∫–Ω–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        1600, 1000,          // –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ (—à–∏—Ä–∏–Ω–∞ x –≤—ã—Å–æ—Ç–∞)
        nullptr, nullptr, hInst, nullptr);

    if (!hWnd) return FALSE;  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –æ–∫–Ω–∞

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    InitializeResources();    // –°–æ–∑–¥–∞–µ–º —à—Ä–∏—Ñ—Ç—ã
    CreateInterface(hWnd);    // –°–æ–∑–¥–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    ShowWelcomeScreen();      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–∫–Ω–∞
    ShowWindow(hWnd, nCmdShow);
    UpdateWindow(hWnd);

    // –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    MSG msg;
    while (GetMessage(&msg, nullptr, 0, 0))
    {
        TranslateMessage(&msg);  // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        DispatchMessage(&msg);   // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–∫–æ–Ω–Ω—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É
    }

    CleanupResources();  // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
    return (int)msg.wParam;
}

// ============================================================================
// –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–°–£–†–°–ê–ú–ò
// ============================================================================

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —à—Ä–∏—Ñ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
void InitializeResources()
{
    // –ö—Ä—É–ø–Ω—ã–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (24pt)
    hFontTitle = CreateFontW(24, 0, 0, 0, FW_BOLD, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, DEFAULT_PITCH | FF_SWISS, L"Segoe UI");

    // –û–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ (14pt)
    hFontButton = CreateFontW(14, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, DEFAULT_PITCH | FF_SWISS, L"Segoe UI");

    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ (13pt)
    hFontText = CreateFontW(13, 0, 0, 0, FW_NORMAL, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, DEFAULT_PITCH | FF_SWISS, L"Segoe UI");

    // –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (14pt)
    hFontBold = CreateFontW(14, 0, 0, 0, FW_BOLD, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, DEFAULT_PITCH | FF_SWISS, L"Segoe UI");

    // –ü–æ–ª—É–∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π (14pt)
    hFontRange = CreateFontW(14, 0, 0, 0, FW_SEMIBOLD, FALSE, FALSE, FALSE,
        DEFAULT_CHARSET, OUT_DEFAULT_PRECIS, CLIP_DEFAULT_PRECIS,
        CLEARTYPE_QUALITY, DEFAULT_PITCH | FF_SWISS, L"Segoe UI");
}

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤
void CleanupResources()
{
    DeleteObject(hFontTitle);   // –£–¥–∞–ª—è–µ–º —à—Ä–∏—Ñ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
    DeleteObject(hFontButton);  // –£–¥–∞–ª—è–µ–º —à—Ä–∏—Ñ—Ç –∫–Ω–æ–ø–æ–∫
    DeleteObject(hFontText);    // –£–¥–∞–ª—è–µ–º –æ–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç
    DeleteObject(hFontBold);    // –£–¥–∞–ª—è–µ–º –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
    DeleteObject(hFontRange);   // –£–¥–∞–ª—è–µ–º —à—Ä–∏—Ñ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
}

// ============================================================================
// –°–û–ó–î–ê–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ì–û –ò–ù–¢–ï–†–§–ï–ô–°–ê
// ============================================================================

// –°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –æ–∫–Ω–µ
void CreateInterface(HWND hWnd)
{
    // === –ì–õ–ê–í–ù–´–ô –ó–ê–ì–û–õ–û–í–û–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
    CreateWindowW(L"STATIC", L"üî¨ –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó–ê–¢–û–† –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–ò K-MEANS",
        WS_VISIBLE | WS_CHILD | SS_CENTER,  // –í–∏–¥–∏–º—ã–π, –¥–æ—á–µ—Ä–Ω–∏–π, —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π
        20, 20, 1540, 40,                   // –ü–æ–∑–∏—Ü–∏—è –∏ —Ä–∞–∑–º–µ—Ä
        hWnd, nullptr, hInst, nullptr);

    // === –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===

    // –ì—Ä—É–ø–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    CreateWindowW(L"BUTTON", L"1. –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•",
        WS_VISIBLE | WS_CHILD | BS_GROUPBOX,  // GroupBox –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        20, 80, 400, 100, hWnd, nullptr, hInst, nullptr);

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV —Ñ–∞–π–ª–∞
    hLoadBtn = CreateWindowW(L"BUTTON", L"üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª",
        WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,
        40, 110, 180, 35, hWnd, (HMENU)ID_LOAD_BUTTON, hInst, nullptr);

    // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    hClearBtn = CreateWindowW(L"BUTTON", L"üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
        WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,
        240, 110, 160, 35, hWnd, (HMENU)ID_CLEAR_BUTTON, hInst, nullptr);

    // === –ì–†–£–ü–ü–ê –ü–ê–†–ê–ú–ï–¢–†–û–í –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–ò ===
    CreateWindowW(L"BUTTON", L"2. –ü–ê–†–ê–ú–ï–¢–†–´ –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–ò",
        WS_VISIBLE | WS_CHILD | BS_GROUPBOX,
        20, 200, 400, 160, hWnd, nullptr, hInst, nullptr);

    // –ü–∞—Ä–∞–º–µ—Ç—Ä K (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤)
    CreateWindowW(L"STATIC", L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (k):",
        WS_VISIBLE | WS_CHILD,
        40, 230, 180, 20, hWnd, nullptr, hInst, nullptr);
    
    hKInput = CreateWindowW(L"EDIT", L"3",  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = 3
        WS_VISIBLE | WS_CHILD | WS_BORDER | ES_NUMBER,  // –¢–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤–æ–π –≤–≤–æ–¥
        230, 228, 60, 25, hWnd, (HMENU)ID_K_INPUT, hInst, nullptr);

    // –ü–æ–¥–ø–∏—Å—å —Å –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–π K
    hKRangeLabel = CreateWindowW(L"STATIC", L"(2-8)",
        WS_VISIBLE | WS_CHILD,
        300, 230, 80, 20, hWnd, nullptr, hInst, nullptr);

    // –ü–∞—Ä–∞–º–µ—Ç—Ä –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    CreateWindowW(L"STATIC", L"–ü–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏:",
        WS_VISIBLE | WS_CHILD,
        40, 260, 150, 20, hWnd, nullptr, hInst, nullptr);
    
    hThresholdInput = CreateWindowW(L"EDIT", L"0.01",  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        WS_VISIBLE | WS_CHILD | WS_BORDER,
        200, 258, 80, 25, hWnd, (HMENU)ID_THRESHOLD_INPUT, hInst, nullptr);

    // –ü–æ–¥–ø–∏—Å—å —Å –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –ø–æ—Ä–æ–≥–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    hThresholdRange = CreateWindowW(L"STATIC", L"(0.001-0.1)",
        WS_VISIBLE | WS_CHILD,
        290, 260, 80, 20, hWnd, nullptr, hInst, nullptr);

    // –ü–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π
    CreateWindowW(L"STATIC", L"–ú–∞–∫—Å–∏–º—É–º –∏—Ç–µ—Ä–∞—Ü–∏–π:",
        WS_VISIBLE | WS_CHILD,
        40, 290, 150, 20, hWnd, nullptr, hInst, nullptr);
    
    hMaxIterInput = CreateWindowW(L"EDIT", L"100",  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        WS_VISIBLE | WS_CHILD | WS_BORDER | ES_NUMBER,
        200, 288, 80, 25, hWnd, (HMENU)ID_MAX_ITER_INPUT, hInst, nullptr);

    // –ü–æ–¥–ø–∏—Å—å —Å –¥–æ–ø—É—Å—Ç–∏–º—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π
    hIterRange = CreateWindowW(L"STATIC", L"(5-500)",
        WS_VISIBLE | WS_CHILD,
        290, 290, 80, 20, hWnd, nullptr, hInst, nullptr);

    // === –ì–†–£–ü–ü–ê –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ê–ù–ê–õ–ò–ó–ê ===
    CreateWindowW(L"BUTTON", L"3. –í–´–ü–û–õ–ù–ï–ù–ò–ï –ê–ù–ê–õ–ò–ó–ê",
        WS_VISIBLE | WS_CHILD | BS_GROUPBOX,
        20, 380, 400, 120, hWnd, nullptr, hInst, nullptr);

    // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    hCalcBtn = CreateWindowW(L"BUTTON", L"üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ö–õ–ê–°–¢–ï–†–ò–ó–ê–¶–ò–Æ",
        WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,
        40, 410, 360, 45, hWnd, (HMENU)ID_CALC_BUTTON, hInst, nullptr);

    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    hProgressBar = CreateWindowW(PROGRESS_CLASS, nullptr,
        WS_VISIBLE | WS_CHILD | PBS_SMOOTH,  // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
        40, 465, 360, 20, hWnd, nullptr, hInst, nullptr);

    // === –ì–†–£–ü–ü–ê –≠–ö–°–ü–û–†–¢–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ===
    CreateWindowW(L"BUTTON", L"4. –≠–ö–°–ü–û–†–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í",
        WS_VISIBLE | WS_CHILD | BS_GROUPBOX,
        20, 520, 400, 80, hWnd, nullptr, hInst, nullptr);

    // –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
    hExportBtn = CreateWindowW(L"BUTTON", L"üíæ –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞",
        WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,
        40, 550, 360, 35, hWnd, (HMENU)ID_EXPORT_BUTTON, hInst, nullptr);

    // === –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ===

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    CreateWindowW(L"STATIC", L"üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê",
        WS_VISIBLE | WS_CHILD | SS_CENTER,
        450, 80, 1100, 30, hWnd, nullptr, hInst, nullptr);

    // –°—Ç—Ä–æ–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å –ø–æ–¥–ø–∏—Å—å—é
    CreateWindowW(L"STATIC", L"–°—Ç–∞—Ç—É—Å:",
        WS_VISIBLE | WS_CHILD,
        450, 120, 60, 20, hWnd, nullptr, hInst, nullptr);
    
    // –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
    hStatusText = CreateWindowW(L"EDIT", L"",
        WS_VISIBLE | WS_CHILD | WS_BORDER | ES_MULTILINE | ES_READONLY | WS_VSCROLL,
        520, 120, 1030, 60, hWnd, nullptr, hInst, nullptr);

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –≤–∫–ª–∞–¥–æ–∫ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    CreateTabControl(hWnd);

    // === –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –®–†–ò–§–¢–û–í –ö –≠–õ–ï–ú–ï–ù–¢–ê–ú ===
    SendMessage(hLoadBtn, WM_SETFONT, (WPARAM)hFontButton, TRUE);
    SendMessage(hClearBtn, WM_SETFONT, (WPARAM)hFontButton, TRUE);
    SendMessage(hCalcBtn, WM_SETFONT, (WPARAM)hFontButton, TRUE);
    SendMessage(hExportBtn, WM_SETFONT, (WPARAM)hFontButton, TRUE);
    SendMessage(hKInput, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hThresholdInput, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hMaxIterInput, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hStatusText, WM_SETFONT, (WPARAM)hFontText, TRUE);

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞ –∫ –ø–æ–¥–ø–∏—Å—è–º –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
    SendMessage(hKRangeLabel, WM_SETFONT, (WPARAM)hFontRange, TRUE);
    SendMessage(hThresholdRange, WM_SETFONT, (WPARAM)hFontRange, TRUE);
    SendMessage(hIterRange, WM_SETFONT, (WPARAM)hFontRange, TRUE);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ K –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
void UpdateKRangeLabel()
{
    if (points.empty()) {
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        SetWindowTextW(hKRangeLabel, L"(min - 2)");
    }
    else {
        // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ K –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
        std::wstring rangeText = L"(2-" + std::to_wstring(points.size()) + L")";
        SetWindowTextW(hKRangeLabel, rangeText.c_str());
    }
}

// ============================================================================
// –°–û–ó–î–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´ –í–ö–õ–ê–î–û–ö –î–õ–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
// ============================================================================

// –°–æ–∑–¥–∞–Ω–∏–µ TabControl –∏ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
void CreateTabControl(HWND hWnd)
{
    // –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∞ –≤–∫–ª–∞–¥–æ–∫
    hTabControl = CreateWindowW(WC_TABCONTROL, L"",
        WS_VISIBLE | WS_CHILD | TCS_TABS,
        450, 200, 1100, 750, hWnd, nullptr, hInst, nullptr);

    if (!hTabControl) {
        MessageBoxW(hWnd, L"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫", L"–û—à–∏–±–∫–∞", MB_OK | MB_ICONERROR);
        return;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
    TCITEM tie;
    tie.mask = TCIF_TEXT;  // –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç

    // –í–∫–ª–∞–¥–∫–∞ 1: –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    tie.pszText = (LPWSTR)L"üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è";
    TabCtrl_InsertItem(hTabControl, 0, &tie);

    // –í–∫–ª–∞–¥–∫–∞ 2: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
    tie.pszText = (LPWSTR)L"üéØ –ö–ª–∞—Å—Ç–µ—Ä—ã";
    TabCtrl_InsertItem(hTabControl, 1, &tie);

    // –í–∫–ª–∞–¥–∫–∞ 3: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ –¥–∞–Ω–Ω—ã—Ö
    tie.pszText = (LPWSTR)L"üìç –¢–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö";
    TabCtrl_InsertItem(hTabControl, 2, &tie);

    // –í–∫–ª–∞–¥–∫–∞ 4: –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    tie.pszText = (LPWSTR)L"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞";
    TabCtrl_InsertItem(hTabControl, 3, &tie);

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–æ–∫
    RECT tabRect;
    GetClientRect(hTabControl, &tabRect);
    TabCtrl_AdjustRect(hTabControl, FALSE, &tabRect);  // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å —É—á–µ—Ç–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤–∫–ª–∞–¥–æ–∫

    // === –°–û–ó–î–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ –î–õ–Ø –ö–ê–ñ–î–û–ô –í–ö–õ–ê–î–ö–ò ===

    // –¢–∞–±–ª–∏—Ü–∞ –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–≤–∫–ª–∞–¥–∫–∞ 1)
    hResultsList = CreateListView(hTabControl, tabRect.left + 10, tabRect.top + 10,
        tabRect.right - tabRect.left - 20, tabRect.bottom - tabRect.top - 20, ID_RESULTS_LIST);
    AddListColumn(hResultsList, L"–ü–∞—Ä–∞–º–µ—Ç—Ä", 200, 0);      // –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    AddListColumn(hResultsList, L"–ó–Ω–∞—á–µ–Ω–∏–µ", 150, 1);      // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    AddListColumn(hResultsList, L"–û–ø–∏—Å–∞–Ω–∏–µ", 700, 2);      // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

    // –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö (–≤–∫–ª–∞–¥–∫–∞ 2)
    hClustersList = CreateListView(hTabControl, tabRect.left + 10, tabRect.top + 10,
        tabRect.right - tabRect.left - 20, tabRect.bottom - tabRect.top - 20, ID_CLUSTERS_LIST);
    AddListColumn(hClustersList, L"–ö–ª–∞—Å—Ç–µ—Ä", 80, 0);           // –ù–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞
    AddListColumn(hClustersList, L"–¢–æ—á–µ–∫", 80, 1);             // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
    AddListColumn(hClustersList, L"–ü—Ä–æ—Ü–µ–Ω—Ç", 80, 2);           // –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ—á–µ–∫
    AddListColumn(hClustersList, L"–¶–µ–Ω—Ç—Ä–æ–∏–¥", 400, 3);         // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
    AddListColumn(hClustersList, L"–°—Ä. —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ", 120, 4);   // –°—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
    AddListColumn(hClustersList, L"–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å", 120, 5);     // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
    AddListColumn(hClustersList, L"–ö–∞—á–µ—Å—Ç–≤–æ", 130, 6);         // –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

    // –¢–∞–±–ª–∏—Ü–∞ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö (–≤–∫–ª–∞–¥–∫–∞ 3)
    hPointsList = CreateListView(hTabControl, tabRect.left + 10, tabRect.top + 10,
        tabRect.right - tabRect.left - 20, tabRect.bottom - tabRect.top - 20, ID_POINTS_LIST);
    AddListColumn(hPointsList, L"–¢–æ—á–∫–∞", 80, 0);                      // –ù–æ–º–µ—Ä —Ç–æ—á–∫–∏
    AddListColumn(hPointsList, L"–ö–ª–∞—Å—Ç–µ—Ä", 80, 1);                    // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
    AddListColumn(hPointsList, L"–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã", 600, 2);                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–∫–∏
    AddListColumn(hPointsList, L"–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞", 150, 3);   // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
    AddListColumn(hPointsList, L"–°—Ç–∞—Ç—É—Å", 150, 4);                    // –°—Ç–∞—Ç—É—Å —Ç–æ—á–∫–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

    // –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫ (–≤–∫–ª–∞–¥–∫–∞ 4)
    hStatsList = CreateListView(hTabControl, tabRect.left + 10, tabRect.top + 10,
        tabRect.right - tabRect.left - 20, tabRect.bottom - tabRect.top - 20, ID_STATS_LIST);
    AddListColumn(hStatsList, L"–ú–µ—Ç—Ä–∏–∫–∞", 200, 0);         // –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    AddListColumn(hStatsList, L"–ó–Ω–∞—á–µ–Ω–∏–µ", 150, 1);        // –ó–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏
    AddListColumn(hStatsList, L"–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è", 700, 2);   // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ –∫–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º
    SendMessage(hResultsList, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hClustersList, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hPointsList, WM_SETFONT, (WPARAM)hFontText, TRUE);
    SendMessage(hStatsList, WM_SETFONT, (WPARAM)hFontText, TRUE);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    ShowTabContent(0);
}

// ============================================================================
// –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ò–ù–¢–ï–†–§–ï–ô–°–û–ú
// ============================================================================

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞
void ResizeInterface(HWND hWnd, int width, int height)
{
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if (width < 1400) width = 1400;
    if (height < 900) height = 900;

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∞ –≤–∫–ª–∞–¥–æ–∫
    if (hTabControl)
        SetWindowPos(hTabControl, NULL, 450, 200, width - 480, height - 240, SWP_NOZORDER);

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–ª—è —Å—Ç–∞—Ç—É—Å–∞
    if (hStatusText)
        SetWindowPos(hStatusText, NULL, 520, 120, width - 550, 60, SWP_NOZORDER);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–æ–∫
    if (hTabControl) {
        RECT tabRect;
        GetClientRect(hTabControl, &tabRect);
        TabCtrl_AdjustRect(hTabControl, FALSE, &tabRect);

        int tableWidth = tabRect.right - tabRect.left - 20;
        int tableHeight = tabRect.bottom - tabRect.top - 20;

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
        if (hResultsList)
            SetWindowPos(hResultsList, NULL, tabRect.left + 10, tabRect.top + 10, tableWidth, tableHeight, SWP_NOZORDER);
        if (hClustersList)
            SetWindowPos(hClustersList, NULL, tabRect.left + 10, tabRect.top + 10, tableWidth, tableHeight, SWP_NOZORDER);
        if (hPointsList)
            SetWindowPos(hPointsList, NULL, tabRect.left + 10, tabRect.top + 10, tableWidth, tableHeight, SWP_NOZORDER);
        if (hStatsList)
            SetWindowPos(hStatsList, NULL, tabRect.left + 10, tabRect.top + 10, tableWidth, tableHeight, SWP_NOZORDER);
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ - –ø–æ–∫–∞–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü—ã
void ShowTabContent(int tabIndex)
{
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
    ShowWindow(hResultsList, SW_HIDE);
    ShowWindow(hClustersList, SW_HIDE);
    ShowWindow(hPointsList, SW_HIDE);
    ShowWindow(hStatsList, SW_HIDE);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
    switch (tabIndex)
    {
    case 0: ShowWindow(hResultsList, SW_SHOW); break;   // –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    case 1: ShowWindow(hClustersList, SW_SHOW); break;  // –ö–ª–∞—Å—Ç–µ—Ä—ã
    case 2: ShowWindow(hPointsList, SW_SHOW); break;    // –¢–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    case 3: ShowWindow(hStatsList, SW_SHOW); break;     // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    }
}

// ============================================================================
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –¢–ê–ë–õ–ò–¶–ê–ú–ò
// ============================================================================

// –°–æ–∑–¥–∞–Ω–∏–µ ListView —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
HWND CreateListView(HWND parent, int x, int y, int w, int h, int id)
{
    HWND hList = CreateWindowW(WC_LISTVIEW, L"",
        WS_VISIBLE | WS_CHILD | WS_BORDER | LVS_REPORT | LVS_SINGLESEL | LVS_SHOWSELALWAYS,
        x, y, w, h, parent, (HMENU)id, hInst, nullptr);

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
    ListView_SetExtendedListViewStyle(hList, LVS_EX_FULLROWSELECT | LVS_EX_GRIDLINES);
    return hList;
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É ListView
void AddListColumn(HWND hList, LPCWSTR text, int width, int index)
{
    LVCOLUMN lvc = { 0 };
    lvc.mask = LVCF_TEXT | LVCF_WIDTH | LVCF_SUBITEM;  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç, —à–∏—Ä–∏–Ω—É –∏ –∏–Ω–¥–µ–∫—Å
    lvc.pszText = (LPWSTR)text;    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–æ–ª–æ–Ω–∫–∏
    lvc.cx = width;                // –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–∫–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
    lvc.iSubItem = index;          // –ò–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏
    ListView_InsertColumn(hList, index, &lvc);
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ (—è—á–µ–π–∫–∏) –≤ —Ç–∞–±–ª–∏—Ü—É ListView
void AddListItem(HWND hList, int item, int subitem, LPCWSTR text)
{
    LVITEM lvi = { 0 };
    lvi.mask = LVIF_TEXT;      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
    lvi.iItem = item;          // –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏
    lvi.iSubItem = subitem;    // –ù–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏
    lvi.pszText = (LPWSTR)text; // –¢–µ–∫—Å—Ç —è—á–µ–π–∫–∏

    if (subitem == 0) {
        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
        ListView_InsertItem(hList, &lvi);
    }
    else {
        // –ò–Ω–∞—á–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —è—á–µ–π–∫—É
        ListView_SetItem(hList, &lvi);
    }
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
void ClearList(HWND hList)
{
    ListView_DeleteAllItems(hList);
}

// ============================================================================
// –§–£–ù–ö–¶–ò–ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –†–ê–ó–õ–ò–ß–ù–´–• –°–û–°–¢–û–Ø–ù–ò–ô –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ============================================================================

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
void ShowWelcomeScreen()
{
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    UpdateStatus(L"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ K-means!\r\n\r\n–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:\r\n1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏\r\n2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\r\n3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑");

    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–∏—Å—Ç–µ–º–µ
    ClearList(hResultsList);
    
    // –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
    AddListItem(hResultsList, 0, 0, L"–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã");
    AddListItem(hResultsList, 0, 1, L"–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ");
    AddListItem(hResultsList, 0, 2, L"–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö");

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ
    AddListItem(hResultsList, 1, 0, L"–ê–ª–≥–æ—Ä–∏—Ç–º");
    AddListItem(hResultsList, 1, 1, L"K-means++");
    AddListItem(hResultsList, 1, 2, L"–£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤");

    // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
    AddListItem(hResultsList, 2, 0, L"–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã");
    AddListItem(hResultsList, 2, 1, L"CSV, TXT");
    AddListItem(hResultsList, 2, 2, L"–§–∞–π–ª—ã —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–ø—è—Ç—ã–º–∏");

    // –û—á–∏—â–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    ClearList(hClustersList);
    ClearList(hPointsList);
    ClearList(hStatsList);

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ K
    UpdateKRangeLabel();
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
void ShowDataLoadedInfo()
{
    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    std::wstringstream status;
    status << L"–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!\r\n\r\n";
    status << L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫: " << points.size() << L"\r\n";
    status << L"–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: " << (points.empty() ? 0 : points[0].coords.size()) << L"\r\n";
    status << L"–ì–æ—Ç–æ–≤ –∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏!";
    UpdateStatus(status.str());

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    PopulateResultsTable();  // –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    PopulatePointsTable();   // –¢–∞–±–ª–∏—Ü–∞ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
    UpdateKRangeLabel();     // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω K
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
void ShowClusteringResults()
{
    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    std::wstringstream status;
    status << L"–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\r\n\r\n";
    status << L"–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∏—Ç–µ—Ä–∞—Ü–∏–π: " << currentIteration << L"/" << maxIterations << L"\r\n";
    status << L"–°—Ö–æ–¥–∏–º–æ—Å—Ç—å: " << (isConverged ? L"–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞" : L"–ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞") << L"\r\n";
    status << L"–û–±—â–∞—è –æ—à–∏–±–∫–∞ SSE: " << std::fixed << std::setprecision(4) << totalSSE;
    UpdateStatus(status.str());

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    PopulateResultsTable();   // –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    PopulateClustersTable();  // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
    PopulatePointsTable();    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ—á–∫–∞—Ö
    PopulateStatsTable();     // –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–ª–µ —Å—Ç–∞—Ç—É—Å–∞
void UpdateStatus(const std::wstring& message)
{
    SetWindowTextW(hStatusText, message.c_str());
}

// ============================================================================
// –§–£–ù–ö–¶–ò–ò –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –¢–ê–ë–õ–ò–¶ –î–ê–ù–ù–´–ú–ò
// ============================================================================

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
void PopulateResultsTable()
{
    ClearList(hResultsList);

    if (clusters.empty()) {
        // –ï—Å–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        
        AddListItem(hResultsList, 0, 0, L"–°—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã—Ö");
        AddListItem(hResultsList, 0, 1, L"–ó–∞–≥—Ä—É–∂–µ–Ω—ã");
        AddListItem(hResultsList, 0, 2, L"–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞");

        std::wstring pointsStr = std::to_wstring(points.size());
        AddListItem(hResultsList, 1, 0, L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫");
        AddListItem(hResultsList, 1, 1, pointsStr.c_str());
        AddListItem(hResultsList, 1, 2, L"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏");

        std::wstring dimsStr = std::to_wstring(points.empty() ? 0 : points[0].coords.size());
        AddListItem(hResultsList, 2, 0, L"–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö");
        AddListItem(hResultsList, 2, 1, dimsStr.c_str());
        AddListItem(hResultsList, 2, 2, L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π (–ø—Ä–∏–∑–Ω–∞–∫–æ–≤) –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏");
    }
    else {
        // –ï—Å–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        
        AddListItem(hResultsList, 0, 0, L"–°—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏");
        AddListItem(hResultsList, 0, 1, L"–ó–∞–≤–µ—Ä—à–µ–Ω–∞");
        AddListItem(hResultsList, 0, 2, L"–ê–ª–≥–æ—Ä–∏—Ç–º K-means —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω");

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Ç–µ—Ä–∞—Ü–∏—è—Ö
        std::wstring iterStr = std::to_wstring(currentIteration) + L"/" + std::to_wstring(maxIterations);
        AddListItem(hResultsList, 1, 0, L"–ò—Ç–µ—Ä–∞—Ü–∏–∏");
        AddListItem(hResultsList, 1, 1, iterStr.c_str());
        AddListItem(hResultsList, 1, 2, L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º–∞");

        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        AddListItem(hResultsList, 2, 0, L"–°—Ö–æ–¥–∏–º–æ—Å—Ç—å");
        AddListItem(hResultsList, 2, 1, isConverged ? L"–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞" : L"–ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞");
        AddListItem(hResultsList, 2, 2, isConverged ? L"–ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ—à–µ–ª—Å—è –∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º—É —Ä–µ—à–µ–Ω–∏—é" : L"–¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –∏—Ç–µ—Ä–∞—Ü–∏–π");

        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        std::wstring kStr = std::to_wstring(k);
        AddListItem(hResultsList, 3, 0, L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤");
        AddListItem(hResultsList, 3, 1, kStr.c_str());
        AddListItem(hResultsList, 3, 2, L"–ó–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞");

        // –û–±—â–∞—è –æ—à–∏–±–∫–∞ SSE (Sum of Squared Errors)
        std::wstringstream sseStr;
        sseStr << std::fixed << std::setprecision(6) << totalSSE;
        AddListItem(hResultsList, 4, 0, L"–û–±—â–∞—è –æ—à–∏–±–∫–∞ (SSE)");
        AddListItem(hResultsList, 4, 1, sseStr.str().c_str());
        AddListItem(hResultsList, 4, 2, L"–°—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ)");
    }
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
void PopulateClustersTable()
{
    ClearList(hClustersList);

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    for (int i = 0; i < k; i++) {
        // –ù–æ–º–µ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞ (–Ω–∞—á–∏–Ω–∞—è —Å 1 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        std::wstring clusterNum = std::to_wstring(i + 1);
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
        std::wstring pointCount = std::to_wstring(clusters[i].pointCount);

        // –ü—Ä–æ—Ü–µ–Ω—Ç —Ç–æ—á–µ–∫ –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        double percentage = (clusters[i].pointCount * 100.0) / points.size();
        std::wstringstream percentStr;
        percentStr << std::fixed << std::setprecision(1) << percentage << L"%";

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
        std::wstringstream centroidStr;
        centroidStr << L"(";
        for (size_t j = 0; j < clusters[i].centroid.size(); j++) {
            centroidStr << std::fixed << std::setprecision(3) << clusters[i].centroid[j];
            if (j < clusters[i].centroid.size() - 1) centroidStr << L", ";
        }
        centroidStr << L")";

        // –°—Ä–µ–¥–Ω–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–æ—á–µ–∫ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
        std::wstringstream avgDistStr;
        avgDistStr << std::fixed << std::setprecision(6) << clusters[i].avgDistance;

        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
        std::wstringstream compactnessStr;
        compactnessStr << std::fixed << std::setprecision(1) << (clusters[i].compactness * 100) << L"%";

        // –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
        std::wstring quality;
        if (clusters[i].compactness > 0.8) quality = L"–û—Ç–ª–∏—á–Ω–æ–µ";
        else if (clusters[i].compactness > 0.6) quality = L"–•–æ—Ä–æ—à–µ–µ";
        else if (clusters[i].compactness > 0.4) quality = L"–°—Ä–µ–¥–Ω–µ–µ";
        else quality = L"–ù–∏–∑–∫–æ–µ";

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É
        AddListItem(hClustersList, i, 0, clusterNum.c_str());
        AddListItem(hClustersList, i, 1, pointCount.c_str());
        AddListItem(hClustersList, i, 2, percentStr.str().c_str());
        AddListItem(hClustersList, i, 3, centroidStr.str().c_str());
        AddListItem(hClustersList, i, 4, avgDistStr.str().c_str());
        AddListItem(hClustersList, i, 5, compactnessStr.str().c_str());
        AddListItem(hClustersList, i, 6, quality.c_str());
    }
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ—á–∫–∞—Ö –¥–∞–Ω–Ω—ã—Ö
void PopulatePointsTable()
{
    ClearList(hPointsList);

    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ç–æ—á–∫–∞–º –¥–∞–Ω–Ω—ã—Ö
    for (size_t i = 0; i < points.size(); i++) {
        // –ù–æ–º–µ—Ä —Ç–æ—á–∫–∏ (–Ω–∞—á–∏–Ω–∞—è —Å 1 –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        std::wstring pointNum = std::to_wstring(i + 1);

        // –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
        std::wstring clusterStr;
        if (points[i].clusterLabel >= 0) {
            clusterStr = std::to_wstring(points[i].clusterLabel + 1);
        }
        else {
            clusterStr = L"–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω";
        }

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–∫–∏
        std::wstringstream coordsStr;
        coordsStr << L"(";
        for (size_t j = 0; j < points[i].coords.size(); j++) {
            coordsStr << std::fixed << std::setprecision(3) << points[i].coords[j];
            if (j < points[i].coords.size() - 1) coordsStr << L", ";
        }
        coordsStr << L")";

        // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –∏ —Å—Ç–∞—Ç—É—Å —Ç–æ—á–∫–∏
        std::wstring distanceStr = L"-";
        std::wstring statusStr = L"–û–∂–∏–¥–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏";

        if (points[i].clusterLabel >= 0 && points[i].clusterLabel < (int)clusters.size()) {
            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
            double distance = CalculateEuclideanDistance(points[i].coords, clusters[points[i].clusterLabel].centroid);
            std::wstringstream distStr;
            distStr << std::fixed << std::setprecision(6) << distance;
            distanceStr = distStr.str();

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Ç–æ—á–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
            if (distance < clusters[points[i].clusterLabel].avgDistance * 0.8) {
                statusStr = L"–ë–ª–∏–∑–∫–æ –∫ —Ü–µ–Ω—Ç—Ä—É";      // –¢–æ—á–∫–∞ –±–ª–∏–∑–∫–æ –∫ —Ü–µ–Ω—Ç—Ä–æ–∏–¥—É
            }
            else if (distance > clusters[points[i].clusterLabel].avgDistance * 1.5) {
                statusStr = L"–ù–∞ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏";          // –¢–æ—á–∫–∞ –¥–∞–ª–µ–∫–æ –æ—Ç —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
            }
            else {
                statusStr = L"–¢–∏–ø–∏—á–Ω–∞—è —Ç–æ—á–∫–∞";        // –¢–æ—á–∫–∞ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É
        AddListItem(hPointsList, static_cast<int>(i), 0, pointNum.c_str());
        AddListItem(hPointsList, static_cast<int>(i), 1, clusterStr.c_str());
        AddListItem(hPointsList, static_cast<int>(i), 2, coordsStr.str().c_str());
        AddListItem(hPointsList, static_cast<int>(i), 3, distanceStr.c_str());
        AddListItem(hPointsList, static_cast<int>(i), 4, statusStr.c_str());
    }
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
void PopulateStatsTable()
{
    ClearList(hStatsList);

    int row = 0;  // –°—á–µ—Ç—á–∏–∫ —Å—Ç—Ä–æ–∫

    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
    std::wstringstream totalPointsStr;
    totalPointsStr << points.size();
    AddListItem(hStatsList, row, 0, L"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫");
    AddListItem(hStatsList, row, 1, totalPointsStr.str().c_str());
    AddListItem(hStatsList, row++, 2, L"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö, —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏");

    // –°—Ä–µ–¥–Ω—è—è –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –Ω–∞ —Ç–æ—á–∫—É
    double avgSSE = totalSSE / points.size();
    std::wstringstream avgSSEStr;
    avgSSEStr << std::fixed << std::setprecision(6) << avgSSE;
    AddListItem(hStatsList, row, 0, L"–°—Ä–µ–¥–Ω—è—è –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞");
    AddListItem(hStatsList, row, 1, avgSSEStr.str().c_str());

    // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ SSE
    std::wstring sseInterpretation;
    if (avgSSE < 1.0) sseInterpretation = L"–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏";
    else if (avgSSE < 5.0) sseInterpretation = L"–•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏";
    else if (avgSSE < 20.0) sseInterpretation = L"–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ";
    else sseInterpretation = L"–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤";

    AddListItem(hStatsList, row++, 2, sseInterpretation.c_str());

    // –ê–Ω–∞–ª–∏–∑ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    double avgClusterSize = (double)points.size() / k;
    bool balanced = true;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ —Å–∏–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è —Ä–∞–∑–º–µ—Ä—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    for (const auto& cluster : clusters) {
        if (cluster.pointCount < avgClusterSize * 0.3 || cluster.pointCount > avgClusterSize * 2.0) {
            balanced = false;
            break;
        }
    }

    AddListItem(hStatsList, row, 0, L"–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Ç–µ—Ä–æ–≤");
    AddListItem(hStatsList, row, 1, balanced ? L"–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã" : L"–ù–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã");
    AddListItem(hStatsList, row++, 2, balanced ? L"–ö–ª–∞—Å—Ç–µ—Ä—ã –∏–º–µ—é—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã" : L"–†–∞–∑–º–µ—Ä—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —Å–∏–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è");

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    AddListItem(hStatsList, row, 0, L"–°—Ö–æ–¥–∏–º–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–∞");
    AddListItem(hStatsList, row, 1, isConverged ? L"–î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞" : L"–ù–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞");
    AddListItem(hStatsList, row++, 2, isConverged ? L"–ê–ª–≥–æ—Ä–∏—Ç–º –Ω–∞—à–µ–ª —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ" : L"–£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π");
}

// ============================================================================
// –ì–õ–ê–í–ù–ê–Ø –û–ö–û–ù–ù–ê–Ø –ü–†–û–¶–ï–î–£–†–ê - –û–ë–†–ê–ë–û–¢–ß–ò–ö –í–°–ï–• –°–û–û–ë–©–ï–ù–ò–ô
// ============================================================================

LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
    switch (message)
    {
    case WM_SIZE:
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        ResizeInterface(hWnd, LOWORD(lParam), HIWORD(lParam));
        break;

    case WM_NOTIFY:
    {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        LPNMHDR pnmh = (LPNMHDR)lParam;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        if (pnmh->hwndFrom == hTabControl && pnmh->code == TCN_SELCHANGE)
        {
            int selectedTab = TabCtrl_GetCurSel(hTabControl);
            ShowTabContent(selectedTab);
        }
        break;
    }

    case WM_COMMAND:
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç –∫–Ω–æ–ø–æ–∫ –∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        switch (LOWORD(wParam))
        {
        case ID_LOAD_BUTTON:
            LoadDataFile();           // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö
            break;
        case ID_CLEAR_BUTTON:
            ClearAllData();           // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            break;
        case ID_CALC_BUTTON:
            RunClusteringAnalysis();  // –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
            break;
        case ID_EXPORT_BUTTON:
            ExportDetailedResults();  // –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            break;
        }
        break;

    case WM_DESTROY:
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        PostQuitMessage(0);
        break;

    default:
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        return DefWindowProc(hWnd, message, wParam, lParam);
    }
    return 0;
}

// ============================================================================
// –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ê–õ–ì–û–†–ò–¢–ú–ê K-MEANS –ò –°–í–Ø–ó–ê–ù–ù–´–• –§–£–ù–ö–¶–ò–ô
// ============================================================================

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
void LoadDataFile()
{
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ª–æ–≥–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞
    ZeroMemory(&ofn, sizeof(ofn));
    ofn.lStructSize = sizeof(ofn);
    ofn.hwndOwner = GetActiveWindow();
    ofn.lpstrFilter = L"CSV Files (*.csv)\0*.csv\0Text Files (*.txt)\0*.txt\0All Files (*.*)\0*.*\0";
    ofn.lpstrFile = szFile;
    ofn.nMaxFile = MAX_PATH;
    ofn.Flags = OFN_FILEMUSTEXIST | OFN_PATHMUSTEXIST;  // –§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

    if (GetOpenFileName(&ofn))
    {
        ClearAllData();  // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        SendMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, 100));
        SendMessage(hProgressBar, PBM_SETPOS, 10, 0);
        UpdateStatus(L"–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...");

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ Unicode
        std::wifstream file(szFile);
        std::wstring line;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
        if (std::getline(file, line)) {
            bool isHeader = false;
            std::wstringstream ss(line);
            std::wstring token;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ
            while (std::getline(ss, token, L',')) {
                try {
                    std::stod(token);  // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                }
                catch (...) {
                    isHeader = true;   // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - —ç—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    break;
                }
            }

            // –ï—Å–ª–∏ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–∞—á–∞–ª—É —Ñ–∞–π–ª–∞
            if (!isHeader) {
                file.seekg(0);
            }
        }

        // –ß—Ç–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö
        while (std::getline(file, line))
        {
            std::wstringstream ss(line);
            std::wstring token;
            Point p;  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Ç–æ—á–∫—É
            p.originalIndex = static_cast<int>(points.size());  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∏–Ω–¥–µ–∫—Å

            // –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–µ (—Ä–∞–∑–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—è—Ç—ã–º–∏)
            while (std::getline(ss, token, L','))
            {
                try {
                    // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏–∑ —Ç–æ–∫–µ–Ω–∞
                    token.erase(std::remove_if(token.begin(), token.end(), ::iswspace), token.end());
                    
                    if (!token.empty()) {
                        double value = std::stod(token);  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —á–∏—Å–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ (–Ω–µ NaN, –Ω–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å)
                        if (std::isfinite(value)) {
                            p.coords.push_back(value);  // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—É –∫ —Ç–æ—á–∫–µ
                        }
                    }
                }
                catch (const std::exception&) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    continue;
                }
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –Ω–µ—ë –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            if (!p.coords.empty()) {
                points.push_back(p);
            }
        }

        file.close();
        SendMessage(hProgressBar, PBM_SETPOS, 100, 0);  // –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

        if (!points.empty()) {
            ShowDataLoadedInfo();  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        }
        else {
            UpdateStatus(L"–û—à–∏–±–∫–∞: –í —Ñ–∞–π–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.\r\n\r\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.");
            SendMessage(hProgressBar, PBM_SETPOS, 0, 0);  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
        }
    }
}

// –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
void RunClusteringAnalysis()
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if (points.empty()) {
        UpdateStatus(L"–û—à–∏–±–∫–∞: –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
        return;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    wchar_t buffer[32];
    
    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
    GetWindowTextW(hKInput, buffer, 32);
    k = _wtoi(buffer);

    // –ü–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    GetWindowTextW(hThresholdInput, buffer, 32);
    convergenceThreshold = _wtof(buffer);

    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
    GetWindowTextW(hMaxIterInput, buffer, 32);
    maxIterations = _wtoi(buffer);

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if (k < 1 || k > static_cast<int>(points.size())) {
        std::wstringstream errorMsg;
        errorMsg << L"–û—à–∏–±–∫–∞: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ " << points.size() << L" (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö).";
        UpdateStatus(errorMsg.str());
        return;
    }

    if (convergenceThreshold <= 0 || convergenceThreshold >= 1) {
        UpdateStatus(L"–û—à–∏–±–∫–∞: –ü–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–∂–¥—É 0 –∏ 1.");
        return;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
    startTime = std::chrono::steady_clock::now();
    SendMessage(hProgressBar, PBM_SETRANGE, 0, MAKELPARAM(0, maxIterations));
    UpdateStatus(L"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤...");

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –º–µ—Ç–æ–¥–æ–º K-means++
    InitializeCentroidsKMeansPlusPlus();
    currentIteration = 0;
    isConverged = false;

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    std::vector<std::vector<double>> prevCentroids;

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–ª–≥–æ—Ä–∏—Ç–º–∞ K-means
    while (currentIteration < maxIterations && !isConverged)
    {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤
        prevCentroids.clear();
        for (const auto& cluster : clusters) {
            prevCentroids.push_back(cluster.centroid);
        }

        // –®–∞–≥ 1: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ—á–µ–∫ –∫ –±–ª–∏–∂–∞–π—à–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º
        AssignPointsToClusters();
        
        // –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤
        UpdateClusterCentroids();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ —Å –ø–æ—Ä–æ–≥–æ–º
        isConverged = true;
        for (int i = 0; i < k; i++) {
            if (CalculateEuclideanDistance(clusters[i].centroid, prevCentroids[i]) > convergenceThreshold) {
                isConverged = false;
                break;
            }
        }

        currentIteration++;
        SendMessage(hProgressBar, PBM_SETPOS, currentIteration, 0);  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å

        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if (currentIteration % 5 == 0) {
            std::wstringstream status;
            status << L"–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏... –ò—Ç–µ—Ä–∞—Ü–∏—è " << currentIteration << L"/" << maxIterations;
            UpdateStatus(status.str());
        }
    }

    // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    CalculateDetailedStatistics();
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    ShowClusteringResults();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –º–µ—Ç–æ–¥–æ–º K-means++ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
void InitializeCentroidsKMeansPlusPlus()
{
    clusters.clear();
    clusters.resize(k);

    // –®–∞–≥ 1: –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥ —Å–ª—É—á–∞–π–Ω–æ
    std::uniform_int_distribution<size_t> dist(0, points.size() - 1);
    clusters[0].centroid = points[dist(rng)].coords;

    // –®–∞–≥ 2: –í—ã–±–∏—Ä–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é, –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
    for (int i = 1; i < k; i++) {
        std::vector<double> distances(points.size());
        double totalDist = 0.0;

        // –î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
        for (size_t j = 0; j < points.size(); j++) {
            double minDist = std::numeric_limits<double>::max();
            
            for (int c = 0; c < i; c++) {
                double d = CalculateEuclideanDistance(points[j].coords, clusters[c].centroid);
                minDist = std::min(minDist, d);
            }
            
            distances[j] = minDist * minDist;  // –ö–≤–∞–¥—Ä–∞—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≤–µ—Å–æ–≤
            totalDist += distances[j];
        }

        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é, –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–µ—Å—É
        std::uniform_real_distribution<double> realDist(0.0, totalDist);
        double target = realDist(rng);
        double cumulative = 0.0;

        for (size_t j = 0; j < points.size(); j++) {
            cumulative += distances[j];
            if (cumulative >= target) {
                clusters[i].centroid = points[j].coords;
                break;
            }
        }
    }
}

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –µ–≤–∫–ª–∏–¥–æ–≤–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –≤ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ
double CalculateEuclideanDistance(const std::vector<double>& a, const std::vector<double>& b)
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–µ–π
    if (a.size() != b.size()) return std::numeric_limits<double>::max();

    double sum = 0.0;
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—É –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —Ä–∞–∑–Ω–æ—Å—Ç–µ–π –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–µ
    for (size_t i = 0; i < a.size(); i++) {
        double diff = a[i] - b[i];
        sum += diff * diff;
    }
    
    return std::sqrt(sum);  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ—Ä–µ–Ω—å –∏–∑ —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤
}

// –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
void AssignPointsToClusters()
{
    // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤ —Ç–æ—á–µ–∫ –≤ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
    for (auto& cluster : clusters) {
        cluster.pointCount = 0;
    }

    // –î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –Ω–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥
    for (auto& point : points) {
        double minDist = std::numeric_limits<double>::max();
        int bestCluster = 0;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞–∂–¥–æ–≥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
        for (int i = 0; i < k; i++) {
            double dist = CalculateEuclideanDistance(point.coords, clusters[i].centroid);
            if (dist < minDist) {
                minDist = dist;
                bestCluster = i;
            }
        }

        // –ù–∞–∑–Ω–∞—á–∞–µ–º —Ç–æ—á–∫—É –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
        point.clusterLabel = bestCluster;
        clusters[bestCluster].pointCount++;
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–≥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–æ—á–µ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
void UpdateClusterCentroids()
{
    for (int i = 0; i < k; i++) {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
        if (clusters[i].pointCount == 0) continue;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä–æ–∏–¥ –Ω—É–ª—è–º–∏
        std::vector<double> newCentroid(clusters[i].centroid.size(), 0.0);

        // –°—É–º–º–∏—Ä—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ—Ö —Ç–æ—á–µ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
        for (const auto& point : points) {
            if (point.clusterLabel == i) {
                for (size_t j = 0; j < point.coords.size(); j++) {
                    newCentroid[j] += point.coords[j];
                }
            }
        }

        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ (–¥–µ–ª–∏–º –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫)
        for (size_t j = 0; j < newCentroid.size(); j++) {
            newCentroid[j] /= clusters[i].pointCount;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
        clusters[i].centroid = newCentroid;
    }
}

// –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
void CalculateDetailedStatistics()
{
    totalSSE = 0.0;  // –°–±—Ä–æ—Å –æ–±—â–µ–π —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫

    for (int i = 0; i < k; i++) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        if (clusters[i].pointCount == 0) {
            clusters[i].avgDistance = 0.0;
            clusters[i].minDistance = 0.0;
            clusters[i].maxDistance = 0.0;
            clusters[i].variance = 0.0;
            clusters[i].compactness = 0.0;
            continue;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        double totalDist = 0.0;
        clusters[i].minDistance = std::numeric_limits<double>::max();
        clusters[i].maxDistance = 0.0;
        std::vector<double> distances;

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –æ—Ç –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
        for (const auto& point : points) {
            if (point.clusterLabel == i) {
                double dist = CalculateEuclideanDistance(point.coords, clusters[i].centroid);
                totalDist += dist;
                distances.push_back(dist);
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
                clusters[i].minDistance = std::min(clusters[i].minDistance, dist);
                clusters[i].maxDistance = std::max(clusters[i].maxDistance, dist);
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ –æ–±—â–µ–π —Å—É–º–º–µ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫
                totalSSE += dist * dist;
            }
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        clusters[i].avgDistance = totalDist / clusters[i].pointCount;

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
        double variance = 0.0;
        for (double dist : distances) {
            variance += (dist - clusters[i].avgDistance) * (dist - clusters[i].avgDistance);
        }
        clusters[i].variance = variance / distances.size();

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ (0 = –ø–ª–æ—Ö–æ, 1 = –æ—Ç–ª–∏—á–Ω–æ)
        if (clusters[i].maxDistance > 0) {
            clusters[i].compactness = 1.0 - (clusters[i].avgDistance / clusters[i].maxDistance);
        }
        else {
            clusters[i].compactness = 1.0;  // –í—Å–µ —Ç–æ—á–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
        }
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
bool ExportDetailedResults()
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    if (points.empty() || clusters.empty()) {
        UpdateStatus(L"–û—à–∏–±–∫–∞: –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é.");
        return false;
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏–∞–ª–æ–≥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
    ZeroMemory(&ofn, sizeof(ofn));
    ofn.lStructSize = sizeof(ofn);
    ofn.hwndOwner = GetActiveWindow();
    ofn.lpstrFilter = L"Text Files (*.txt)\0*.txt\0All Files (*.*)\0*.*\0";
    ofn.lpstrFile = szSaveFile;
    ofn.nMaxFile = MAX_PATH;
    ofn.lpstrDefExt = L"txt";
    ofn.Flags = OFN_PATHMUSTEXIST | OFN_OVERWRITEPROMPT;
    wcscpy_s(szSaveFile, L"kmeans_results.txt");  // –ò–º—è —Ñ–∞–π–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    if (GetSaveFileName(&ofn))
    {
        // –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞ –æ—Ç—á–µ—Ç–∞
        std::ofstream file(szSaveFile);
        if (!file.is_open()) {
            UpdateStatus(L"–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.");
            return false;
        }

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á–µ—Ç–∞
        file << "=== ENHANCED K-MEANS CLUSTERING RESULTS - PERFECT EDITION ===\n\n";

        // –°–µ–∫—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        file << "Parameters:\n";
        file << "  Number of clusters (k): " << k << "\n";
        file << "  Convergence threshold: " << std::fixed << std::setprecision(2) << convergenceThreshold << "\n";
        file << "  Max iterations: " << maxIterations << "\n";
        file << "  Actual iterations: " << currentIteration << "\n\n";

        // –°–µ–∫—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞
        file << "Quality metrics:\n";
        file << "  SSE (Sum of Squared Errors): " << std::fixed << std::setprecision(6) << totalSSE << "\n\n";

        // –°–µ–∫—Ü–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ç–æ—á–µ–∫ –∫ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
        file << "Cluster assignments:\n";
        for (size_t i = 0; i < points.size(); i++) {
            file << "Point " << (i + 1) << ": Cluster " << (points[i].clusterLabel + 1) << " (";
            
            // –í—ã–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ—á–∫–∏
            for (size_t j = 0; j < points[i].coords.size(); j++) {
                file << std::fixed << std::setprecision(3) << points[i].coords[j];
                if (j < points[i].coords.size() - 1) file << ", ";
            }
            file << ")\n";
        }

        // –°–µ–∫—Ü–∏—è —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
        file << "\nCluster centroids and statistics:\n";
        for (int i = 0; i < k; i++) {
            file << "Cluster " << (i + 1) << ":\n";
            file << "  Points: " << clusters[i].pointCount << "\n";
            file << "  Centroid: (";
            
            // –í—ã–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞
            for (size_t j = 0; j < clusters[i].centroid.size(); j++) {
                file << std::fixed << std::setprecision(6) << clusters[i].centroid[j];
                if (j < clusters[i].centroid.size() - 1) file << ", ";
            }
            file << ")\n";
            file << "  Average intra-cluster distance: " << std::fixed << std::setprecision(6) << clusters[i].avgDistance << "\n\n";
        }

        file.close();

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —ç–∫—Å–ø–æ—Ä—Ç–µ
        UpdateStatus(L"–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!\r\n\r\n–§–∞–π–ª: " + std::wstring(szSaveFile));
        return true;
    }

    return false;
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
void ClearAllData()
{
    points.clear();           // –û—á–∏—â–∞–µ–º –≤—Å–µ —Ç–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    clusters.clear();         // –û—á–∏—â–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
    currentIteration = 0;     // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π
    isConverged = false;      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    totalSSE = 0.0;          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–±—â—É—é –æ—à–∏–±–∫—É
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    SendMessage(hProgressBar, PBM_SETPOS, 0, 0);
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É —ç–∫—Ä–∞–Ω—É
    ShowWelcomeScreen();
}
